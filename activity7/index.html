<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Activity 7: the audio tag + events</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    .controls div {
      float: left;
      margin: 10px;
      border: 3px solid #000;
      font-size: 2em;
      text-align: center;
      width: 50px;
      border-radius: 5px;
    }
  </style>
</head>

<body>
  <h1>Activity 7: the audio tag + events</h1>
  <p>This is a music player with a playlist</p>
  <ul>
    <li>Add a play icon to the item in the playlist that is currently playing.</li>
    <li>Add controls to <a href="https://developer.mozilla.org/es/docs/Web/HTML/Elemento/audio">audio tag</a>:
      play/pause, go back, go forward.</li>
    <li>When 1 audio ends the following one must estart playing automatically</li>
  </ul>






  <ol id="trackList">
    <li><input id="1810 Beethoven- Fur Elise.mp3" type='submit' class="track" value='track 1'><i></i></li>
    <li><input id="1729 Vivaldi , Mandoline Concerto in C, RV 425.mp3" type='submit' class="track" value='track 2'><i></i></li>
    <li><input id="1721 Bach , Brandenburg Concerto No. 3, 1st movement.mp3" type='submit' class="track" value='track 3'><i></i></li>
  </ol>







  <div id="reproductor">


    <!--
    <audio controls >
      <source src="1810 Beethoven- Fur Elise.mp3" type="audio/mpeg">
      Your browser does not support the audio tag.
    </audio>
-->



  </div>







  <div class="controls">
    <div class="play"><i class="fa fa-play"></i></div>
    <div class="backward"><i class="fa fa-step-backward"></i></div>
    <div class="fordward"><i class="fa fa-step-forward"></i></div>
  </div>





  <script>




    function initControls() {


      var play = document.getElementsByClassName('play');

      play[0].addEventListener('click', playPause);

      var nextTrackButton = document.getElementsByClassName('fordward');

      nextTrackButton[0].addEventListener('click', nextTrack);

      var previousTrackButton = document.getElementsByClassName('backward');

      previousTrackButton[0].addEventListener('click', previousTrack);

    }






    function playPause() {

      var play = document.getElementsByClassName('play');

      var iPlay = play[0].children[0];

      if (audio.paused) {

        audio.play()

        iPlay.classList.replace('fa-pause', 'fa-play')

        trackSelected(audio.getAttribute(name), true)

      } else {

        audio.pause()

        iPlay.classList.replace('fa-play', 'fa-pause')

        trackSelected(audio.getAttribute(name), false)

      }

    }





    function nextTrack() {

      var audio = document.getElementById("audio")

      var tracks = document.getElementsByClassName('track');

      for (let index = 0; index < tracks.length; index++) {

        if (tracks[index].id == audio.getAttribute('name')) {

          if (index == tracks.length - 1) {

            audio.setAttribute('src', tracks[0].id)

            audio.setAttribute('name', tracks[0].id)

            audio.play()

            trackSelected(tracks[0].id, true)

          } else {

            index += 1

            audio.setAttribute('src', tracks[index].id)

            audio.setAttribute('name', tracks[index].id)

            audio.play()

            trackSelected(tracks[index].id, true)

          }

          

        }

      }

    }







    function previousTrack() {

      audio = document.getElementById("audio")

      var tracks = document.getElementsByClassName('track');

      for (let index = 0; index < tracks.length; index++) {

        if (tracks[index].id == audio.getAttribute('name')) {

          if (index == 0) {

            audio.setAttribute('src', tracks[0].id)

            audio.setAttribute('name', tracks[0].id)

            audio.play()

            trackSelected(tracks[0].id, true)


          } else {

            index -= 1

            audio.setAttribute('src', tracks[index].id)

            audio.setAttribute('name', tracks[index].id)

            audio.play()

            trackSelected(tracks[index].id, true)

          }

        }

      }

    }






















    function createAudio(defaultTrack) {

      initControls()

      var defaultTrack = trackList()

      nuevo_audio = document.createElement("audio")

      nuevo_audio.setAttribute("id", "audio")

      nuevo_audio.setAttribute("controls", "controls")

      nuevo_audio.setAttribute("name", defaultTrack)

      nuevo_audio.setAttribute("src", defaultTrack)

      nuevo_audio.setAttribute("autoplay", "autoplay")

      //  nuevo_audio.setAttribute("loop", "loop")

      padre = document.getElementById("reproductor")

      padre.appendChild(nuevo_audio)

      nuevo_audio.onended = nextTrack

      trackSelected(defaultTrack, true)

    }










    function trackList() {

      var tracks = document.getElementsByClassName('track');


      for (let item of tracks) {

        item.addEventListener('click', loadTrack);

      }

      return tracks[0].id

    }





    //obtengo el track y se lo paso a cargar reproductor
    function loadTrack(e) {

      var event = e || window.event;

      track = event.target.id;

      // cargarTrack(event.target.id);
      audio = document.getElementById('audio');

      audio.setAttribute('src', track)

      audio.setAttribute('name', track)

      audio.play()

      trackSelected(track,true)

    }





    function trackSelected(track, itsPlay) {

      var audio = document.getElementById("audio")

      var tracks = document.getElementsByClassName('track');


      for (let index = 0; index < tracks.length; index++) {

        tracks[index].nextSibling.className = ''

        if (tracks[index].id == audio.getAttribute('name')) {


          if(itsPlay){

          tracks[index].nextSibling.classList.add('fa')
          tracks[index].nextSibling.classList.add('fa-play')

          }else{

            tracks[index].nextSibling.classList.add('fa')
            tracks[index].nextSibling.classList.add('fa-pause')


          }


        }

      }

    }










    createAudio();



  </script>
</body>

</html>